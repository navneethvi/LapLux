<%- include("../partials/header") %>





    <main class="main">
        <div class="page-header breadcrumb-wrap">
            <div class="container">
                <div class="breadcrumb">
                    <a href="index.html" rel="nofollow">Home</a>
                    <span></span> Shop
                    <span></span> Your Cart
                </div>
            </div>
        </div>
        <section class="mt-50 mb-50">
            <div class="container">
                <div class="row">
                    <div class="col-9">
                        <div class="table-responsive">
                            <table class="table shopping-summery text-center clean">
                                <thead>
                                    <tr class="main-heading">
                                        <th scope="col">Image</th>
                                        <th scope="col">Name</th>
                                        <th scope="col">Price</th>
                                        <th scope="col">Quantity</th>
                                        <th scope="col">Remove</th>
                                    </tr>
                                </thead>
                                <tbody>

                                    <% if (product.length> 0) { %>

                                        <% for (let i=0; i < data.length;i++) { %>

                                            <tr>
                                                <td class="image product-thumbnail">
                                                    <img src="/uploads/product-images/<%= data[i].productDetails[0].productImage[0] %>"
                                                        alt="#" />
                                                </td>
                                                <td class="product-des product-name">
                                                    <h5 class="product-name">
                                                        <a href="shop-product-right.html">
                                                            <%= data[i].productDetails[0].productName %>
                                                        </a>
                                                    </h5>
                                                    <p class="font-xs">
                                                        <%= data[i].productDetails[0].category %><br />
                                                            <%= data[i].productDetails[0].brand %>.
                                                    </p>
                                                </td>
                                                <td class="price" data-title="Price"><span>₹ <%=
                                                            data[i].productDetails[0].salePrice.toLocaleString('en-IN')
                                                            %> </span><br>
                                                    <small class="text-muted text-nowrap">₹<span id="price">
                                                            <%=data[i].productDetails[0].salePrice.toLocaleString('en-IN')%></span>
                                                        / per item </small>

                                                </td>


                                                <td class="text-center" data-title="Stock">
                                                    <div class="detail-qty border radius m-auto">
                                                        <div class="quantity-control">

                                                            <button class="btn btn-sm increment-button"
                                                                onclick="console.log('Button clicked')">+</button>

                                                            <input class="quantity-input<%= i %>"
                                                                id="quantity<%= data[i].quantity %>"
                                                                value="<%= data[i].quantity %>" style="width: 45px;"
                                                                type="text" readonly value="">
                                                            <button class="btn btn-sm decrement-button"
                                                                onclick="console.log('Button clicked'),changeQuantity('<%=data[i]._id%>' , '<%=data[i].productId%>' ,-1,'<%=data[i].productDetails[0].quantity%>')">-</button>


                                                        </div>
                                                    </div>
                                                </td>





                                                <td class="action" data-title="Remove">
                                                    <a class="btn btn-sm"
                                                        href="/deleteItem?id=<%= data[i].productDetails[0]._id %>">
                                                        <i class="fi-rs-trash"></i>
                                                    </a>
                                                </td>




                                                <% } %>
                                                    <% } else { %>
                                            <tr>
                                                <td colspan="2">No item found in Cart</td>
                                            </tr>
                                            <% } %>


                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="col-3">
                        <div class="border p-md-4 p-30 border-radius cart-totals">
                            <div class="heading_s1 mb-3">
                                <h4>Cart Totals</h4>
                            </div>
                            <div class="table-responsive">
                                <table class="table">
                                    <tbody>
                                        <tr>
                                            <td class="cart_total_label">Cart Subtotal</td>
                                            <td class="cart_total_amount"><span class="font-lg fw-900 text-brand">₹
                                                    <text id="grandTotal"><%=total.toLocaleString('en-IN')%></text>
                                                </span></td>
                                        </tr>
                                        <tr>
                                            <td class="cart_total_label">Shipping</td>
                                            <td class="cart_total_amount"> <i class="ti-gift mr-5"></i> Free Shipping
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="cart_total_label">Total</td>
                                            <td class="cart_total_amount"><strong><span
                                                        class="font-xl fw-900 text-brand">₹
                                                        <%=total.toLocaleString('en-IN')%></span></strong></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <a href="#" class="btn "> <i class="fi-rs-box-alt mr-10"></i> Proceed To CheckOut</a>
                        </div>
                    </div>

                </div>

            </div>
            </div>
            </div>
            </div>
        </section>
    </main>



    <script>
        function changeQuantity(userId, prodId, count, unit) {
            console.log("IM HERE");
            let quantity = document.getElementById("quantity")
            quantity = parseInt(quantity)
            if (unit < quantity + 1) {
                let quantity = getElementById("prodId").value
                quantity = parseInt(quantity)
                unit = parseInt(unit)
                if (quantity + 1 > unit) {
                    Swal.fire({
                        title: 'STOCK!',
                        text: 'Product is out of stock.',
                        icon: 'error',
                        timer: 3000
                    })
                }
            } else {
                let proTotal = document.getElementById("productTotal").innerHTML
                let price = document.getElementById("price").innerHTML
                proTotal = parseInt(proTotal)
                price = parseInt(price)
                if (count == 1) {
                    document.getElementById("productTotal").innerHTML = proTotal + price
                    price = document.getElementById("price").innerHTML
                    let grandTotal = document.getElementById("grandTotal").innerHTML
                    document.getElementById("grandTotal").innerHTML = parseInt(grandTotal) + parseInt(price)
                }
                $.ajax({
                    url: "/changeQuantity",
                    method: "post",
                    data: {
                        userId: userId,
                        prodId: prodId,
                        count: count,
                        quantity: quantity
                    },
                    success: (response) => {
                        console.log(response.status);
                        if (response.status == true) {
                            location.reload()
                        } else {
                            let total = parseInt(quantity) + parseInt(count);
                            document.getElementById(prodId).value = total;
                        }
                    }
                })
            }
        } 
    </script>



    <%- include("../partials/footer") %>